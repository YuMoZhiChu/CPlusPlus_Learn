# 重载运算与类型转换

# 基本概念

- 重载的运算符是具有特殊名字的函数，它们由**关键字**`operator`以及后面定义的**运算符号**组成
- 一元运算符需要 1 个参数
- 二元运算符需要 2 个参数，左侧运算对象 -> 第一个参数，右侧运算对象 -> 第二个参数
- 如果是成员函数，那么 this 会自动绑定到第一个运算对象上，参数比非成员函数少一个

```c++
// 不能重定义内置类型的运算符
int operator+(int, int);
```

## 直接调用一个重载的运算符函数
```c++
// 一个非成员函数的等价调用
data1 + data2; // 表达式调用
data1.operator+=(data2); // 等价的函数调用
```

## 某些运算符不应该被重载

- 逻辑的与或运算符，逗号运算符，内置了运算对象的求值顺序规则，重载就无法保留
- `&&`和`||`有短路求值的技巧，重载也无法保留
- **逗号，取地址，逻辑与，逻辑或** 别重载！！！！

## 使用与内置类型含义一致

- 类执行IO操作时，定义移位运算符，应该与IO类型保持一致
- 类有了`==`，应该也有`!=`
- 重载运算符，返回值 应该符合内置版本
- - 逻辑和关系：返回 bool
- - 算术：返回一个 类类型 值
- - 赋值和复合赋值：返回 左侧运算对象 的一个 引用

## 选择作为成员或者非成员

- `=`,`[]`,`()`,`->` **必须是成员函数**
- 复合赋值运算符，一般是成员函数，但是不是必须
- 改变对象状态的运算符，或者与类型相关的，比如`++`,`--`,`*`(解引用)，通常是成员
- 具有对称性，比如`算术`,`相等性`,`关系`,`位运算`，应该是非成员

```c++
string s = "world";
string t = s + "!"; // 无论 string的+ 是成员，还是非成员，都OK
string u = "hi" + s; // 如果这里是 string的+ 是成员，则会保持

// s的+ 是成员
string u = "hi".operator+(s); // 显然没有定义
// s的+ 是非成员
string u = operator+("hi", s); // 显然，这里是可以调用的
```
- 一般来说，对称性的，应该写作 成员
- 重载符号函数，调用要求
- - 实参能转形参（一般函数也需要
- - 至少一个对象是类类型







